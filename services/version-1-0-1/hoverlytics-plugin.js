/* (c) 2013 Patrick Smith */"Copyright 2013 Patrick Smith";function hoverlyticsSetUp(){var e=hoverlyticsPageViewer.localProxyFileURL,t=hoverlyticsPageViewer.getGoogleAnalyticsProfileID("hoverlyticsGoogleAnalyticsProfileID"),n='{"sourceProxyURL":"'+e+'"'+(t?',"googleAnalyticsProfileID":"'+t+'"':"")+"}",r=hoverlyticsPageViewer.baseURL,i=r+"services/proxy.html",s=hoverlyticsPageViewer.proxy=new Porthole.WindowProxy(i,"hoverlyticsPageViewerIFrame");s.addEventListener(hoverlyticsPageViewerReceivedMessage);var o=r+"#"+encodeURIComponent(n),u=hoverlyticsPageViewer.$iframe=jQuery("<iframe>",{id:"hoverlyticsPageViewerIFrame",name:"hoverlyticsPageViewerIFrame",width:250,height:"100%",src:o,frameborder:"0",scrolling:"no"}),a=hoverlyticsPageViewer.$holder=jQuery("<div></div>",{id:"hoverlyticsPageViewerHolder"});hoverlyticsPageViewerUpdateAlignment();a.toggleClass("demo",!!hoverlyticsPageViewer.isDemo);a.append(u);a.appendTo("body");var f=jQuery("<a></a>",{id:"hoverlyticsPageViewerToggleButton"});f.on("click",hoverlyticsPageViewerToggleButtonClicked);var l=jQuery("<a></a>",{id:"hoverlyticsPageViewerSettingsButton","class":"icon-cog"});l.on("click",hoverlyticsPageViewerSettingsButtonClicked);var c=jQuery("<div></div>",{id:"hoverlyticsPageViewerButtonBar"});c.append(f,l);a.append(c);c.on("mouseover",function(e){hoverlyticsPageViewerChangeActive(!0)});hoverlyticsPageViewer.ready=!0;hoverlyticsPageViewerChangeEnabled(hoverlyticsPageViewer.getEnabled());hoverlyticsPageViewer.linkToLoad&&hoverlyticsChangeTargetPageLink(hoverlyticsPageViewer.linkToLoad)}function hoverlyticsPageViewerUpdateAlignment(e){var t=hoverlyticsPageViewer.$holder,n=hoverlyticsPageViewer.getAlignment();if(e&&e.previousAlignment){t.addClass("changingAlignment");var r={};r[e.previousAlignment]="-300px";t.animate(r,480,function(){t.toggleClass("alignedLeft",n==="left");t.toggleClass("alignedRight",n==="right");r[e.previousAlignment]="auto";r[n]="-300px";t.css(r);r[n]="0";t.animate(r,400,function(){t.removeClass("changingAlignment");r[e.previousAlignment]="";r[n]="";t.css(r)})})}else{t.toggleClass("alignedLeft",n==="left");t.toggleClass("alignedRight",n==="right")}hoverlyticsPageViewerToggleUpdateSettingsView()}function hoverlyticsPageViewerChangeActive(e){hoverlyticsPageViewer.$holder.toggleClass("active",e)}function hoverlyticsPageViewerChangeEnabled(e){e==null&&(e=!hoverlyticsPageViewer.getEnabled());hoverlyticsPageViewer.setEnabled(e);hoverlyticsPageViewer.$holder.toggleClass("enabled",e)}function hoverlyticsPageViewerChangeHeight(e){hoverlyticsPageViewer.$holder.height(e)}function hoverlyticsPageViewerToggleShowingSettings(){var e=jQuery("#hoverlyticsPageViewerSettings");if(e.size()===0){e=jQuery("<div></div>",{id:"hoverlyticsPageViewerSettings"});var t=jQuery("<a></a>",{id:"hoverlyticsPageViewerSettingsAlignLeft","data-icon":"\ue002"}).text("Align Left"),n=jQuery("<a></a>",{id:"hoverlyticsPageViewerSettingsAlignRight","data-icon":"\ue003"}).text("Align Right");e.append(t,n);t.on("click",function(e){hoverlyticsPageViewer.setAlignment("left")});n.on("click",function(e){hoverlyticsPageViewer.setAlignment("right")});hoverlyticsPageViewer.$holder.append(e);hoverlyticsPageViewerToggleUpdateSettingsView()}setTimeout(function(){e.toggleClass("active")},1)}function hoverlyticsPageViewerToggleUpdateSettingsView(){var e=hoverlyticsPageViewer.getAlignment();jQuery("#hoverlyticsPageViewerSettingsAlignLeft").toggleClass("selected",e==="left");jQuery("#hoverlyticsPageViewerSettingsAlignRight").toggleClass("selected",e==="right")}function hoverlyticsPageViewerToggleButtonClicked(e){e.preventDefault();hoverlyticsPageViewerChangeEnabled()}function hoverlyticsPageViewerSettingsButtonClicked(e){e.preventDefault();hoverlyticsPageViewerToggleShowingSettings()}function hoverlyticsMouseEnteredPageLink(e){if(!hoverlyticsPageViewer.getEnabled())return;var t=jQuery(e.target).closest("a[href]");hoverlyticsBeginTargetingLink(t)}function hoverlyticsBeginTargetingLink(e){e=e.filter(":not([href^='#']):not([href^='mailto:'])");e=e.filter("[href*='"+location.hostname+"'], [href^='/']");e=e.filter(":not([href*='/wp-admin/'])");if(e.size()===0)return!1;if(e.data("hoverlyticsMouseIsTargeting"))return;if(hoverlyticsPageViewer.targetedLink){hoverlyticsCancelTargetingLink(hoverlyticsPageViewer.targetedLink);hoverlyticsPageViewer.targetedLink=null}e.data("hoverlyticsMouseIsTargeting",!0);hoverlyticsPageViewer.targetedLink=e;var t={},n=0;e.on("mousemove.hoverlyticsChecking",function(e){var r={x:e.pageX,y:e.pageY};if(t.usedBefore){var i=Math.abs(r.x-t.x),s=Math.abs(r.y-t.y);n+=Math.sqrt(i*i+s*s)}t=r;t.usedBefore=!0});e.on("mouseout.hoverlyticsChecking",function(t){hoverlyticsCancelTargetingLink(e)});e.on("hoverlyticsCheckMouse.hoverlyticsChecking",function(){if(n<=8){hoverlyticsChangeTargetPageLink(e);hoverlyticsCancelTargetingLink(e)}else n=0});var r=hoverlyticsPageViewer.pageLinkTimeoutDuration,i=setInterval(function(){e.trigger("hoverlyticsCheckMouse")},r);e.data("hoverlyticsTimeout",i)}function hoverlyticsCancelTargetingLink(e){var t=e.data("hoverlyticsTimeout");t&&clearInterval(t);e.data("hoverlyticsMouseIsTargeting",!1);e.off(".hoverlyticsChecking")}function hoverlyticsChangeTargetPageLink(e){hoverlyticsPageViewer.$holder.addClass("messagePassed");if(hoverlyticsPageViewer.getEnabled())if(hoverlyticsPageViewer.proxy){hoverlyticsPageViewer.proxy.post({changePageURL:e.attr("href")});hoverlyticsPageViewerChangeActive(!0)}else hoverlyticsPageViewer.linkToLoad=e}function hoverlyticsPageViewerReceivedMessage(e){if(!e||!e.data)return;if(e.data.viewsReady){var t=hoverlyticsPageViewer.getEnabledSections();hoverlyticsPageViewer.proxy.post({enabledSections:t})}else if(e.data.newProfileIDSelected){var n=e.data.newProfileIDSelected;hoverlyticsPageViewer.setGoogleAnalyticsProfileID(n)}else if(e.data.needsUser)hoverlyticsPageViewerChangeActive(!0);else if(e.data.changeHeight){var r=e.data.changeHeight;hoverlyticsPageViewerChangeHeight(r)}else if(e.data.sectionIsEnabledChanged){var i=e.data.sectionIsEnabledChanged;hoverlyticsPageViewer.changeSectionIsEnabled(i.sectionID,i.isEnabled)}}window.hoverlyticsPageViewer=jQuery.extend({getEnabled:function(){this.enabled==null&&(this.enabled=jQuery.cookie("hoverlyticsPageViewerEnabled")!="0");return this.enabled},setEnabled:function(e){jQuery.cookie("hoverlyticsPageViewerEnabled",e?"1":"0");this.enabled=e},defaultAlignment:"left",getAlignment:function(){this.alignment||(this.alignment=jQuery.cookie("hoverlyticsPageViewerAlignment")||this.defaultAlignment);return this.alignment},setAlignment:function(e){var t=this.alignment||null;if(this.alignment===e)return;jQuery.cookie("hoverlyticsPageViewerAlignment",e,{expires:1780,path:"/"});jQuery.cookie("hoverlyticsSettingsDidChange","1",{path:"/"});this.alignment=e;hoverlyticsPageViewerUpdateAlignment({previousAlignment:t})},getGoogleAnalyticsProfileID:function(){return jQuery.cookie("hoverlyticsGoogleAnalyticsProfileID")},setGoogleAnalyticsProfileID:function(e){jQuery.cookie("hoverlyticsGoogleAnalyticsProfileID",e,{expires:1780,path:"/"});jQuery.cookie("hoverlyticsSettingsDidChange","1",{path:"/"})},getEnabledSections:function(){if(this.enabledSections==null)try{var e={},t=jQuery.cookie("hoverlyticsPageViewerEnabledSections").split(",");jQuery.each(t,function(t,n){n&&(e[n]=!0)});this.enabledSections=e}catch(n){this.enabledSections={}}return this.enabledSections},changeSectionIsEnabled:function(e,t){var n=this.getEnabledSections();n[e]=t;this.saveEnabledSections()},saveEnabledSections:function(){var e=[];jQuery.each(this.enabledSections,function(t,n){n&&e.push(t)});jQuery.cookie("hoverlyticsPageViewerEnabledSections",e.join(","))}},window.hoverlyticsPageViewer||{});jQuery(document).on("mouseover","a[href]",hoverlyticsMouseEnteredPageLink);jQuery(function(){hoverlyticsSetUp()});